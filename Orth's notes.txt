Ok, fixed code by checking if usedTimes/metronomeCount are undefined in ko_chance, and setting them to 1 if so.

This solution does not account for stat drops from moves such as Overheat, nor does it account for the effects of Metronome. I will probably want to account for this.
e.g. Latias-Mega (Uber Support)	Draco Meteor	36.2 - 43%	guaranteed 3HKO

In order to do so, both counters must increment for every turn the pokemon fails to KO. This cannot be done in shared_controls where the respective variables are set for 1v1 and 1va modes, since there is no UI for determining these values ahead of calculating xHKOs, so they must be determined in ko_chance
One option to consider is just adding the appropriate UI to set these values manually. It's not inconceivable that players would want the option to either calc two fresh DMeteors (e.g. if the pokemon are switching between attacks) or two consecutive DMeteors (in which case stat drops are applied)

Interestingly, I think the Metronome boost is only being calculated for a single attack based on prior usage
252 Atk Metronome Abomasnow Ice Shard vs. 0 HP / 0- Def Abomasnow: 88-104 (27.4 - 32.3%) -- guaranteed 4HKO
This should be a possible 3HKO if we're actually applying the Metronome boost with each hit.
I guess this is by design? Still, seems odd when you're determining xHKOs for a single move

Consider making the default Metronome count 0. Currently it's 1, which assumes that the move has been used on the prior turn. I think this is really weird, given the UI's default value is never. It also produces some odd, though technically correct KO text if never is selected (either "guaranteed KO in 1 turns" or "not a KO")

Ooooooook turns out stat drop moves aren't quite working in 1va either. Using Abomasnow's ZU usage set with Leaf Storm (x2) and no Wood Hammer, I got the following results:
	Jirachi (OU Choice Scarf)	Leaf Storm	28.7 - 34%	not a KO 
		[This is correct, but not a KO is still something that's an unusual result]
	Kyogre-Primal (Uber Calm Mind + Water Spout)	Leaf Storm	76.2 - 90.9%	not a KO 
		[Over two turns this is a guaranteed KO]
	Keldeo (OU Calm Mind)	Leaf Storm	132.5 - 156.6%	guaranteed KO in 2 turns after Leftovers recovery 
		[This is an OHKO lol]
	Kyogre (Uber Calm Mind + Water Spout)	Leaf Storm	87.9 - 103.8%	81.3% chance to 2HKO 
		[It's giving the odds for a 2HKO, which is totally unnecessary since it's guaranteed. Should be giving odds for OHKO]